# 架構決策記錄 (Architecture Decision Record)

## ADR-001: 選擇 Google Test 作為主要測試框架
**日期**: 2025-07-31  
**狀態**: ✅ 已採用

### 決策
使用 Google Test 而非 cucumber-cpp 作為主要測試框架

### 背景
- 原計畫使用 cucumber-cpp 實現 BDD
- cucumber-cpp v0.6.0 在 Windows 環境有相依性問題
- 需要快速建立可工作的測試環境

### 後果
- ✅ 快速建立測試環境，支援 BDD 風格
- ✅ 良好的 Visual Studio 整合
- ❌ 失去 Gherkin 語法的業務可讀性
- 🔄 未來可遷移回 cucumber-cpp

---

## ADR-002: 單週期執行 vs 管線實現
**日期**: 2025-07-31  
**狀態**: 🔄 暫時性

### 決策
先實現單週期指令執行，管線功能延後

### 背景
- 需要快速驗證指令解析和執行邏輯
- 管線實現複雜度較高
- BDD 測試專注於功能正確性

### 後果
- ✅ 快速實現和驗證基本指令
- ✅ 簡化除錯過程
- ❌ 不符合最終管線設計目標
- 🔄 需要後續重構為管線執行

---

## ADR-003: R-type 指令繼承架構
**日期**: 2025-07-31  
**狀態**: ✅ 已採用

### 決策
創建 `RTypeInstruction` 基礎類別統一 R-type 指令

### 背景
- ADD 和 SUB 指令有相同的欄位結構
- 消除程式碼重複
- 為未來 R-type 指令奠定基礎

### 後果
- ✅ 減少程式碼重複
- ✅ 提高可維護性
- ✅ 易於擴展新 R-type 指令
- ✅ 符合 OOP 設計原則

---

## ADR-004: 字串組譯 vs 檔案讀取
**日期**: 2025-07-31  
**狀態**: ✅ 已採用

### 決策
優先實現字串組譯，檔案讀取作為次要功能

### 背景
- 測試需要動態程式碼生成
- 字串解析較檔案 I/O 簡單
- 減少測試環境複雜度

### 後果
- ✅ 簡化測試撰寫
- ✅ 減少 I/O 相關錯誤
- ❌ CLI 使用性受限
- 🔄 需補強檔案讀取功能

---

## ADR-005: CMake + FetchContent 相依性管理
**日期**: 2025-07-31  
**狀態**: ✅ 已採用

### 決策
使用 CMake FetchContent 管理外部相依性

### 背景
- 避免手動安裝相依性
- 確保版本一致性
- 支援跨平台建置

### 後果
- ✅ 簡化建置設定
- ✅ 自動相依性管理
- ✅ 良好的 CI/CD 支援
- ❌ 初次建置時間較長

---

## 未來決策待議

### ADR-006: 錯誤處理策略
- 異常 vs 錯誤碼
- 無效指令處理
- 記憶體存取錯誤

### ADR-007: 管線實現方式
- 單一 tick() 所有階段 vs 分階段 tick()
- 管線暫存器設計
- 氣泡插入機制

### ADR-008: 記憶體模型
- 統一記憶體 vs 分離指令/資料記憶體
- 記憶體對齊政策
- 快取模擬程度
